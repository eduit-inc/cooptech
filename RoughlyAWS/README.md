# ざっくり解説AWS

## ターゲット
- AWSの詳しいことはわからないけど、用語や概要は知っておきたい人
- または、AWSの環境構築している人の話がわかるようになりたい人

## 概要

普段利用する機会の多いと思われるサービスの紹介。

VPCとオンプレを接続するDirect系は説明しません。

## ネットワークサービス

### AWS

AWSそのもの。あらゆるサービスを内包している

### リージョン

リージョンは世界中にAWSが保有しているデータセンターのこと。日本には、東京（ap-northeast-1）と大阪（ap-northeast-3）が存在する。

2024年2月現在、世界に32のリージョンを保有している。

日本のシステムでは東京リージョンが選択されることが多い。

### アベイラビリティーゾーン

AZと呼称される。

高可用性を満たすために、一つのリージョンの中でも同じ環境を複数AZに構築することが多い。

東京は以下の4つのAZが存在する。
- ap-northeast-1a
- ap-northeast-1c
- ap-northeast-1d
- ap-northeast-1e

### エッジロケーション
CDNを配置している拠点のこと。

AZを上回る数が存在している。CDNをはいちすることで、地理的に近いエッジロケーションを選択し、効率よくコンテンツを配布できる。

### VPC (Virtual Private Cloud)

ネットワーク環境の構築において一番広い単位。

AWSのハードウェアは全ユーザで共有されるものだが、それを「VPC」と呼ばれる仮想ネットワークを作成し
論理って気に分割する。分割されたネットワークは特定のユーザのみが利用できる**プライベートネットワーク**となる。

プライベートネットワークなので、ネットワークのセキュリティを確保することができる。VPC作成当初は誰も繋げない。

ざっくりなので細かくは記載しないが、後述するサブネットも同様に**CIDR**表記でネットワークを構築する点に注意。
CIDRの知識が必要。

### サブネット

VPC内に構築するネットワークのセグメント。ユーザーはどのサブネットをどのAZに構成するかを決められる。
また、1つのVPCに複数のサブネットを作ることが可能。

ただし、前述した**CIDR**に注意。VPCのCIDRで指定したIPアドレスの範囲内でサブネットのCIDRを決める必要がある。

### インターネットゲートウェイ(IGW)

インターネットゲートウェイは、サブネットをインターネット上に通信可能にするための出入り口。

#### ポイント

ここまで、「パブリック」「プライベート」という分けられている点がポイントだと個人的には思う。

基本VPCはプライベートであるため、他社のVPC同士をつなぐことはできないが「VPCピアリング」という機能を用いることで
VPC同士の通信を可能にする。
また、ルーティングはデフォルトではプライベートで通信不可だが「ルーティングテーブル」を書くことで、
HTTP通信、SSH接続などが可能になる。

IGWに接続されているサブネットを「パブリックサブネット」、IGWに接続されていないサブネットを「プライベートサブネット」と呼ぶ。

### NATゲートウェイ

NATとはそもそもNetwork Address Translationの略で、ネットワークアドレスの変換を行うもの。

NATゲートウェイはそのNATの機能をプライベートサブネットにあてがうことでプライベートサブネットと同じように
インターネットに接続できるようになる。

パブリックサブネットは、IGWを使ってインターネットに露出する。

プライベートサブネットは、インターネットに露出したくない情報（社内用APIなど）を置いておくのに便利。

ただ、アクセスされたくないけれど、他のサイトのAPIにアクセスをしたいといったような
**インバウンド**は拒否したいけど**アウトバウンド**はしたい場合に用いるのがNATゲートウェイである。
他の例として、プライベートサブネット内のEC2のOSにパッチを当てるためにDLする、などが挙げられる。

### セキュリティグループ (SCG)

EC2に対するファイアウォール。

EC2から出る通信の**アウトバウンド**とEC2に入る通信の**インバウンド**の設定を行う。

デフォルトは、インバウンドはすべて拒否されるため、必ずSSHやHTTP通信の設定が必要。

### VPCと外部との接続

使用例がオンブレなのでここでは名称だけ紹介。

もしオンプレとAWSを通信することがあったり、AWSとVPNをつなぐことがあればこれらのキーワードで調べると良い。

#### AWS Direct Connect

#### AWS VPN

#### VPC ピアリング

通常ユーザごとに保持されているVPCを相互に接続する機能。

### ELB (Elastic Load Balancing)

主に、EC2へのトラフィックを分散するロードバランサー。

特徴は以下

#### 高可用性

高可用性が効果として挙げられている。
トラフィックを複数のAZで分散できるため、地理的に離れたデータセンターの利用が可能。

特定のAZの障害が発生しても正常なインスタンスとの通信を続けることが可能。

#### オートスケーリング

負荷に応じて自動的にスケーリングする機能を備えている。

#### セキュリティ機能

SSL通信を可能とする機能を保持している。

AWS ACM(AWS Certificate Manager)を利用して証明書発行を行いHTTPSの通信を可能とする。

#### ヘルスチェック

EC2インスタンスが正常に動作しているかヘルスチェックを行う。

### Route53

DNSを提供するサービス。
外部向けDNSの「パブリックホストゾーン」とVPC内部向けの「プライベートホストゾーン」がある。
パブリックホストゾーンを利用して、Webサーバの名前解決に利用して、
プライベートホストゾーンはインターネットを介さない通信の名前解決に利用する。

特徴として、レコードにAWS特有の**ALIASレコード**がある。

AmplifyやELBなどをサービスを指定することでつなぐことができる。

#### ルーティングポリシー

もし試験受けたりがっつりやるひとは、「ルーティングポリシー」を調べると良い。

結論、ルーティングの優先度の付け方にはいくつか方法があって、それらに名前がついているよ、というだけ。

## アクセス制御サービス
### IAM (AWS Identity and Access Management)

ユーザ管理。ロールの付与から、CLIの許可など。

ルートユーザとしてまずアカウントを作成し、作業ユーザを作り、そのユーザで普段操作すること。

## コンピューティングサービス

### EC2 (Amazon Elastic Compute Cloud)

#### AMI (Amazon Machine Image)

OSイメージとソフトウェア設定がセットで配布されている。

AmazonLinux2に独自に色々設定することが基本だが、例えばRedmineがデフォルトで設定されているAMIもあったりする。

また、自分で独自に設定したAMIを自分専用のAMIとして配布したりEC2インスタンスを複製することも可能。

AWS Marketplaceにて様々なAMIを選択できる。

#### ストレージ

EBSを割り当てることが可能。

#### セキュリティーグループ

SCGをEC2インスタンスに割り当てることが可能。

#### キーペアの設定

EC2へのログインは公開鍵認証方式。キーペアが必須。

#### ライフサイクル

| 状態            | 内容                                          | 課金対象 |
|---------------|---------------------------------------------|------|
| pending       | running前の状態。EC2立ち上げてすぐまたはstoppedから起動する場合の状態 | 対象外  |
| running       | 起動中                                         | 対象   |
| stopping      | 停止準備中                                       | 対象外  |
| stopped       | 停止済みで利用不可。再開は可能。                            | 対象外  |
| shutting-down | 削除準備中                                       | 対象外  |
| terminated    | 完全に削除されているため再開不可                            | 対象外  |

#### ユーザーデータ

インスタンス初回起動時に必ず行われるコマンド。

EC2設定時にコマンドを記載できる

#### インスタンスメタデータ

EC2インスタンス自身に関する情報。

「リンクローカルアドレス」というIPアドレスに`/latest/mata-data`へアクセスすると、
- インスタンスID
- プライベートアドレス
- パブリックアドレス
- ローカルホスト名
- 公開鍵

などが閲覧できる。

#### オートスケーリング

リソースの使用状況をモニタリングして、自動でスケールアウトするサービス。

- EC2 Auto Scaling: スケーリングするルールに従ってインスタンスをスケーリングする。
- AWS Auto Scaling: 自動スケーリングと予測スケーリングの両方を持つ。
予測スケーリングは、過去のメトリクスから予測・分析して適切な利用状況になるように管理する。
EC2のみならずEC2やAuroraレプリカなどのサービスも対象。

Auto Scalingは指定してたAMIを起動するため、AMIを最新にする必要がある。

ユーザデータを使ってgitからソースを取得してビルドしておく、などなど。

### その他、オンプレと接続するサービス

Direct、と名前のつくサービスはだいたいそう

## コンテナ関連のサービス

名称のみ紹介

### Amazon Elastic Container Service(ECS)

docker使うやつ。

### Amazon Elastic Kubernates Service(EKS)

コンテナ同士の分離を意識することなく一つのサービスとして利用できるようにつなぎ合わせるサービス

(docker composeでいいのでは？派)

### AWS Fargate

### Amazon Elastic Container Registry(ECR)

## AWS Lambda

## アプリケーションデプロイ関連サービス

### AWS Amplify
### AWS Elastic Beanstalk

## ストレージサービス

### Amazon Simple Storage Service(S3)

「バケット」単位で保管する。

可用性工場のためにS3に保管したオブジェクトは、デフォルトで同一リージョン内の3箇所のAZに複製される。

### Amazon Elastic Block Store(EBS)

S3が独立したサービスなのに対して、EBSはEC2に割り当てられるHDDやSSDのような役割

### Amazon Elastic File System (EFS)

スケーラブルな共有ストレージ。EBSのようにインスタンスなどに依存をせずに、
複数のEC2インスタンスやECSコンテナなどの今日中ファイルストレージとして利用できる。 

### Amazon FSx

ファイルシステムの色々。

個人的に興味があるのは`FSx for Windows File Server`。これでActive Directoryの機能を利用できる。

## データベースサービス

### Amazon Relational Database Service (RDS)

言わずもがな、DBサービス

## データ処理・分析サービス

### 概要

データ処理・連携を支援するサービス群。

アプリケーションで実装することなく、AWSと切り分けることができる。

### メッセージキューイング処理サービス

#### SQS (Amazon Simple Queue Service)

キューイングサービス。バッチのように、非同期・並列な分散処理が可能。

### 通知処理サービス

#### SES (Amazon Simple Email Service)

Eメール送信サービス

#### SNS (Amazon Simple Notification Service)

さまざまなプロトコルでサービスにデータを配信する

- SMS
- スマホへのプッシュ通知
- メール送信
- SQS連携
- Lambda連携
- CloudWatch連携

SESはメール送信特化。

SNSはプッシュ型。自発的に様々なアクションを起こす場合に利用する。

SQSはプル型と呼ばれる。受動的に外部からのアクションに対して起こされる処理を指す。

SNSのようにメッセージを配信するする形式(Publish, Subscribe)をPub/Subという。

### バイプライン処理

DBからのデータの抽出・変換・保存 (ETL: Extract Transform Load) や、データの順次処理が求められる。

**AWS Data Pipeline** で、ETLなどのデータの順次処理を行うことができる。

プログラムで同期処理を指せるのではなく、Data Pipelineで同期処理を行わせる。

例えば、

1. DBからデータエクスポート
2. エクスポートしたデータを変換、S3に保存
3. エクスポートしたデータをテーブルから削除

を一つのトランザクションとして扱われる。**AWS Glue**や**AWS Step Functions**もPipeline同様、パイプライン制御できるサービス。

多すぎやしないか？

ちなみにPipelineは2023/2/28に廃止した。らしい。

### ストリーミング処理サービス

**Amazon Kinesis**を利用する。IoTなどのデバイスからデータをリアルタイムに受信して分析する場合に利用。

Kinesisは主に次の3つのサービスから構成される

- Kinesis Data Streams: ストリーミングデータの収集
- Kinesis Data Firehose: ストリーミングデータの保存
- Kinesis Data Analytics: ストリーミングデータの分析

### イベント連携処理サービス

**Amazon EventBridge**で、AWSの各種サービスや外部のSaaSのイベントソースで発生するイベントを起動するハブのような存在。

### その他のデータ連携・分析サービス

紹介だけ

#### Amazon AppFlow

Slack、SalesforceやSAPと連携してデータをS3などに転送するサービス

#### AWS Lake Formation

データレイクというだけあってのこの名前なのかな。

データ処理・分析に必要なデータの蓄積場所。

#### Amazon EMR

ペタバイトレベルのデータを処理、分析するスケーラブルな処理サービス

#### Amazon OpenSearch Service (Amazon ElasticSearch Service)

オープンソースのElasticSearchをベースとしたログ分析・検索サービス。

なんかよく聞く。

#### Amazon QuickSight

分析されたデータを可視化するためのダッシュボード

#### AWS Data Exchange

世界中に存在するサードパーティデータをAWSがサブスク方式で提供するサービス

…使う？？

### AI、機械学習サービス紹介

#### Amazon Comprehend

機械学習で、テキストから関係性を発見するための自然言語処理(NLP)サービス

#### Amazon Forecast

機械学習(ML)をベースにした予測サービス

#### Amazon Fraud Detector

機械学習でオンライン不正行為の特定・発見、不正検出モデルを構築するサービス

#### Amazon Kendra

機械学習を利用したインテリジェント検索サービス

インテリジェントって何

#### Amazon Lex

チャットボットなどの会話形インターフェイスを備えたAI

#### Amazon Polly

文章をリアルな音声に変換するサービス

#### Amazon Rekognition

画像と動画から情報などを抽出

#### Amazon SageMaker

機械学習モデルの統合的な開発プラットフォーム

具体的にはわからん

#### Amazon Textract

スキャンしたドキュメントからテキストや手が気持ち、データを自動的に抽出するMLサービス

すげえ。

#### Amazon Transcribe

音声をテキストに自動変換するサービス

#### Amazon Translate 

カスタマイズ可能な言語翻訳サービス

## 構成管理サービス・開発サービス